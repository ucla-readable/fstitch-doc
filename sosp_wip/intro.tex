% -*- mode: latex; tex-main-file: "abstract.tex" -*-

\section*{Introduction}
\label{sec:intro}

For robustness, stability, and reboot speed, filesystem implementations
must ensure that the filesystem's stored image is kept consistent
or easy to return to consistency.
%
Advanced consistency mechanisms such as soft updates~\cite{ganger00soft}
and journalling make this possible; unfortunately,
%
consistency mechanisms are generally tied to a particular filesystem, and
can neither be ported nor adapted without significant engineering
effort.
%
Furthermore, interfaces like \verb+fsync()+ give user code coarse control
over consistency.
%
Applications with custom consistency and performance requirements get
little help from conventional filesystems, which either impose high
overhead (data journalling) or don't guarantee data consistency (soft
updates, for example, provides metadata consistency).



We propose a new filesystem implementation architecture called
\emph{KudOS}.
%
KudOS \emph{change descriptor} structures represent any and all changes to
stable storage.
%
File systems generate change descriptors for all writes, then
send them to block devices for eventual commit.
%
Each change descriptor stores the old state of the block and the change's
\emph{dependencies}---other change descriptors that must be committed before
it is safe to commit this change.
%
Explicit dependencies let KudOS modules preserve necessary filesystem
invariants without understanding the filesystem itself; the old state
lets KudOS roll back changes when necessary to break cyclic dependencies.
%
Change descriptors can implement many ways of achieving
consistency, including soft updates and journalling.
%
%
%
KudOS is entirely decomposed into fine-grained modules which generate,
consume, forward, and manipulate change descriptors.
%
A particular innovation of KudOS's module design is the separation of the
low-level specification of on-disk layout from higher-level
filesystem-independent code, which operates on abstract disk
structures.

We have implemented a functional prototype of the KudOS
architecture.
%
Our journalling module should automatically add journalling to any file
system, and combinations of simple modules can support, for example,
correct consistency on RAID over loopback devices.
%
Eventually, we plan for KudOS to support user-defined dependencies,
allowing applications to define consistency protocols that the filesystem
will follow.

%
%% They also support
%% the implementation of many other possible definitions of filesystem
%% consistency, which in the future we hope will allow for userspace
%% specification. 
%
%% Besides eventually supporting user-defined dependency structures, the
%% current module system already allows interesting new interactions, such as
%% correct consistency on RAID over loopback devices.
