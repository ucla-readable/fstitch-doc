<html>
<head>
<title>Kudos Test Metrics</title>

<script language="JavaScript"type="text/javascript" src="plots/time_tar.js"></script>
<script language="JavaScript"type="text/javascript" src="plots/time_rm.js"></script>
<script language="JavaScript"type="text/javascript" src="plots/time_postmark.js"></script>

<script language="JavaScript"type="text/javascript" src="plots/space_tar.js"></script>
<script language="JavaScript"type="text/javascript" src="plots/space_rm.js"></script>
<script language="JavaScript"type="text/javascript" src="plots/space_postmark.js"></script>

<script language="JavaScript"type="text/javascript" src="plots/io_tar.js"></script>
<script language="JavaScript"type="text/javascript" src="plots/io_rm.js"></script>
<script language="JavaScript"type="text/javascript" src="plots/io_postmark.js"></script>

<script language="JavaScript" type="text/javascript"> <!--
function sysName(testData)
{
	return testData[0] + ' ' + testData[1] + ' ' + testData[2];
}

function addTimeTest(tblId, testData)
{
	var row = document.getElementById(tblId).insertRow(-1);
	row.insertCell(-1).innerHTML = sysName(testData);
	row.insertCell(-1).innerHTML = testData[3];
	row.insertCell(-1).innerHTML = testData[6];
	row.insertCell(-1).innerHTML = testData[12];
	row.insertCell(-1).innerHTML = testData[9];
}

function loadTimes()
{
	for (sys in time_tar_data)
		addTimeTest('timeTarTable', time_tar_data[sys]);
	for (sys in time_rm_data)
		addTimeTest('timeRmTable', time_rm_data[sys]);
	for (sys in time_postmark_data)
		addTimeTest('timePostmarkTable', time_postmark_data[sys]);
}

function addSpaceTest(tblId, testName, testData)
{
	var row = document.getElementById(tblId).insertRow(-1);
	var rollbackIndex = 30; // don't write #items for this index
	row.insertCell(-1).innerHTML = testName + ': ' + testData[2];
	for (var i = 0; i <= rollbackIndex; i += 5)
	{
		var nitems = testData[i + 6];
		var sizeof = testData[i + 7];
		var size = (nitems * sizeof / 1024).toFixed(0);
		var str;
		if (i != rollbackIndex)
			str = nitems + ' (' + size + ' kB)';
		else
			str = size + ' kB';
		row.insertCell(-1).innerHTML = str;
	}
}

function loadSpace()
{
	for (sys in space_tar_data)
		addSpaceTest('spaceTable', 'tar', space_tar_data[sys]);
	for (sys in space_rm_data)
		addSpaceTest('spaceTable', 'rm', space_rm_data[sys]);
	for (sys in space_postmark_data)
		addSpaceTest('spaceTable', 'postmark', space_postmark_data[sys]);
}

function addIoTest(tblId, testData)
{
	var row = document.getElementById(tblId).insertRow(-1);
	row.insertCell(-1).innerHTML = sysName(testData);
	row.insertCell(-1).innerHTML = testData[3].toFixed(1);
	row.insertCell(-1).innerHTML = testData[6].toFixed(1);
	row.insertCell(-1).innerHTML = testData[15].toFixed(1);
	row.insertCell(-1).innerHTML = testData[18].toFixed(1);
	row.insertCell(-1).innerHTML = testData[9].toFixed(1);
	row.insertCell(-1).innerHTML = testData[12].toFixed(1);
}

function loadIo()
{
	for (sys in io_tar_data)
		addIoTest('ioTarTable', io_tar_data[sys]);
	for (sys in io_rm_data)
		addIoTest('ioRmTable', io_rm_data[sys]);
	for (sys in io_postmark_data)
		addIoTest('ioPostmarkTable', io_postmark_data[sys]);
}

function loadData()
{
	loadTimes();
	loadSpace();
	loadIo();
}
--> </script>
</head>
<body onLoad='loadData()'>

<img src="graph.png" align="right">
<h1>Kudos Test Metrics</h1>

Time (<a href="#time_pit">Current</a>, <a href="#time_history">History</a>),
Space (<a href="#space_pit">Current</a>, <a href="#space_history">History</a>),
I/O (<a href="#io_pit">Current</a>, <a href="#io_history">History</a>)

<hr size="1" width="100%" noshade>
<a name="current">
<h2>Current</h2>

<a name="time_pit">
<h3>Time</h3>
<table border="1" id="timeTarTable">
		<caption>tar</caption>
		<tr><th></th> <th>real</th> <th>sys</th> <th>io</th> <th>user</th></tr>
</table>

<table border="1" id="timeRmTable">
		<caption>rm</caption>
		<tr><th></th> <th>real</th> <th>sys</th> <th>io</th> <th>user</th></tr>
</table>

<table border="1" id="timePostmarkTable">
		<caption>postmark</caption>
		<tr><th></th> <th>real</th> <th>sys</th> <th>io</th> <th>user</th></tr>
</table>

<a name="space_pit">
<h3>Space</h3>
<table border="1" id="spaceTable">
		  <tr><th></th> <th>bits</th> <th>bytes</th> <th>noops</th> <th>all</th> <th>deps</th> <th>wrefs</th> <th>rollback</th>
</table>

<a name="io_pit">
<h3>I/O</h3>
<table border="1" id="ioTarTable">
		<caption>tar</caption>
		<tr><th></th> <th>write requests</th> <th>write kBs</th> <th>read requests</th> <th>read kBs</th> <th># multi-write sectors</th> <th># writes to multi-write sectors</th></tr>
</table>

<table border="1" id="ioRmTable">
		<caption>rm</caption>
		<tr><th></th> <th>write requests</th> <th>write kBs</th> <th>read requests</th> <th>read kBs</th> <th># multi-write sectors</th> <th># writes to multi-write sectors</th></tr>
</table>

<table border="1" id="ioPostmarkTable">
		<caption>postmark</caption>
		<tr><th></th> <th>write requests</th> <th>write kBs</th> <th>read requests</th> <th>read kBs</th> <th># multi-write sectors</th> <th># writes to multi-write sectors</th></tr>
</table>


<hr size="1" noshade>
<a name="history">
<h2>Kudos History</h2>

<a name="time_history">
<h3>Time</h3>
<p>
<img src="plots/time_tar.png">
<img src="plots/time_rm.png">
<img src="plots/time_postmark.png">
</p>

<a name="space_history">
<h3>Space</h3>
<p>
<img src="plots/space_tar.png">
<img src="plots/space_rm.png">
<img src="plots/space_postmark.png">
</p>

<a name="io_history">
<h3>I/O</h3>
<h4>All</h3>
<p>
<img src="plots/io_tar.png">
<img src="plots/io_rm.png">
<img src="plots/io_postmark.png">
</p>

<h4>Multi-writes</h3>
<p>
<img src="plots/io_multi_tar.png">
<img src="plots/io_multi_rm.png">
<img src="plots/io_multi_postmark.png">
</p>


<hr size="1" noshade>
<h2>Chdesc Overhead</h2>
Plot chdesc memory vs number of block writes?
(Is this a good way to give us an idea of how well optimizations work
among different tests?)

<hr size="1" noshade>
<a name="su">
<h2>Soft Update Correctness</h2>
TODO.

 </body>
</html>
