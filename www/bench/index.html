<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Kudos Test Metrics</title>

<style type="text/css">
div.flow { float: left; }
div.space { clear: both; }

table { border-collapse: collapse; border: 1px solid black; margin: 0px 10px 10px 0px; font-family: "FreeSans"; font-size: 12; }
table th.test { background-color: white; font-style: italic; }
table tr { background-color: #FFF0E6; border: 1px solid black; }
table tr:hover { background-color: #E6F0FF; font-weight: bold; }
table tr.header { border-bottom: 1px solid; }
table th { background-color: white; border: 1px solid black; }
table th#units { font-weight: normal; }
table th.row { font-weight: normal; text-align: left; padding-right: 0.35em; }
table td { text-align: right; padding: 0.35ex 0.35em 0.35ex 0.35em; border: 1px solid black; }

hr { height: 1px; width: 100%; border: none; color: #9E9E9E; background-color: #9E9E9E; }

img.floatright { float: right; border: none; }
br.floatright { clear: right; }
</style>

<script type="text/javascript" src="plots/time_tar.js"></script>
<script type="text/javascript" src="plots/time_rm.js"></script>
<script type="text/javascript" src="plots/time_postmark.js"></script>
<script type="text/javascript" src="plots/time_andrew.js"></script>

<script type="text/javascript" src="plots/space_tar.js"></script>
<script type="text/javascript" src="plots/space_rm.js"></script>
<script type="text/javascript" src="plots/space_postmark.js"></script>
<script type="text/javascript" src="plots/space_andrew.js"></script>

<script type="text/javascript" src="plots/io_tar.js"></script>
<script type="text/javascript" src="plots/io_rm.js"></script>
<script type="text/javascript" src="plots/io_postmark.js"></script>
<script type="text/javascript" src="plots/io_andrew.js"></script>

<script type="text/javascript"> <!--
function sysName(testData)
{
	return testData[0] + ' ' + testData[1] + ' ' + testData[2];
}

function appendRowHeader(row, text)
{
	var node = document.createElement("th");
	node.className = "row";
	node.appendChild(document.createTextNode(text));
	row.appendChild(node);
}

function appendData(row, text)
{
	var node = document.createElement("td");
	node.appendChild(document.createTextNode(text));
	row.appendChild(node);
}

function addTimeTest(tblId, testData)
{
	var row = document.getElementById(tblId).insertRow(-1);
	appendRowHeader(row, sysName(testData));
	appendData(row, testData[3].toFixed(2));
	appendData(row, testData[6].toFixed(2));
	appendData(row, testData[12].toFixed(2));
	appendData(row, testData[9].toFixed(2));
}

function loadTimes()
{
	for (sys in time_tar_data)
		addTimeTest('timeTarTable', time_tar_data[sys]);
	for (sys in time_rm_data)
		addTimeTest('timeRmTable', time_rm_data[sys]);
	for (sys in time_postmark_data)
		addTimeTest('timePostmarkTable', time_postmark_data[sys]);
	for (sys in time_andrew_data)
		addTimeTest('timeAndrewTable', time_andrew_data[sys]);
}

function addSpaceTest(tblId, testName, testData)
{
	var row = document.getElementById(tblId).insertRow(-1);
	var rollbackIndex = 30; // don't write #items for this index
	appendRowHeader(row, testName + ': ' + testData[2]);
	for (var i = 0; i <= rollbackIndex; i += 5)
	{
		var nitems = testData[i + 6];
		var sizeof = testData[i + 7];
		var size = (nitems * sizeof / 1024).toFixed(0);
		appendData(row, nitems);
		appendData(row, size);
		var str;
		if (i != rollbackIndex)
			str = nitems + ' (' + size + ' kB)';
		else
			str = size + ' kB';
		/*appendData(row, str);*/
	}
}

function loadSpace()
{
	for (sys in space_tar_data)
		addSpaceTest('spaceTable', 'tar', space_tar_data[sys]);
	for (sys in space_rm_data)
		addSpaceTest('spaceTable', 'rm', space_rm_data[sys]);
	for (sys in space_postmark_data)
		addSpaceTest('spaceTable', 'postmark', space_postmark_data[sys]);
	for (sys in space_andrew_data)
		addSpaceTest('spaceTable', 'andrew', space_andrew_data[sys]);
}

function addIoTest(tblId, testData)
{
	var row = document.getElementById(tblId).insertRow(-1);
	appendRowHeader(row, sysName(testData));
	appendData(row, testData[3].toFixed(0));
	appendData(row, testData[6].toFixed(0));
	appendData(row, testData[15].toFixed(0));
	appendData(row, testData[18].toFixed(0));
	appendData(row, testData[9].toFixed(0));
	appendData(row, testData[12].toFixed(0));
}

function loadIo()
{
	for (sys in io_tar_data)
		addIoTest('ioTarTable', io_tar_data[sys]);
	for (sys in io_rm_data)
		addIoTest('ioRmTable', io_rm_data[sys]);
	for (sys in io_postmark_data)
		addIoTest('ioPostmarkTable', io_postmark_data[sys]);
	for (sys in io_andrew_data)
		addIoTest('ioAndrewTable', io_andrew_data[sys]);
}

function loadData()
{
	loadTimes();
	loadSpace();
	loadIo();
}
--> </script>
</head>
<body onLoad='loadData()'>

<p>
<img src="graph.png" class="floatright" alt="graph icon">
</p>

<h1>Kudos Test Metrics</h1>

<p>
Time (<a href="#time_pit">Current</a>, <a href="#time_history">History</a>),
Space (<a href="#space_pit">Current</a>, <a href="#space_history">History</a>),
I/O (<a href="#io_pit">Current</a>, <a href="#io_history">History</a>)
<br class="floatright">
</p>

<hr>

<a name="current"></a>
<h2>Current</h2>

<a name="time_pit"></a>
<h3>Time</h3>
<div class="flow">
<table id="timeTarTable">
	<tr class="header"><th class="test">tar</th> <th class="col">real</th> <th class="col">sys</th> <th class="col">io</th> <th class="col">user</th></tr>
</table>
</div>

<div class="flow">
<table id="timeRmTable">
	<tr class="header"><th class="test">rm</th> <th class="col">real</th> <th class="col">sys</th> <th class="col">io</th> <th class="col">user</th></tr>
</table>
</div>

<div class="flow">
<table id="timePostmarkTable">
	<tr class="header"><th class="test">postmark</th> <th class="col">real</th> <th class="col">sys</th> <th class="col">io</th> <th class="col">user</th></tr>
</table>
</div>

<div class="flow">
<table id="timeAndrewTable">
	<tr class="header"><th class="test">andrew</th> <th class="col">real</th> <th class="col">sys</th> <th class="col">io</th> <th class="col">user</th></tr>
</table>
</div>
<div class="space"></div>

<a name="space_pit"></a>
<h3>Space</h3>
<table id="spaceTable">
	  <tr class="header"><th class="col"></th> <th class="col" colspan="2">bits</th> <th class="col" colspan="2">bytes</th> <th class="col" colspan="2">noops</th> <th class="col" colspan="2">all</th> <th class="col" colspan="2">deps</th> <th class="col" colspan="2">wrefs</th> <th class="col" colspan="2">rollback</th>
	  <tr class="header"><th class="units"></th> <th class="units">items</th> <th class="units">kB</th> <th class="units">items</th> <th class="units">kB</th> <th class="units">items</th> <th class="units">kB</th> <th class="units">items</th> <th class="units">kB</th> <th class="units">items</th> <th class="units">kB</th> <th class="units">items</th> <th class="units">kB</th> <th class="units">items</th> <th class="units">kB</th>
</table>

<a name="io_pit"></a>
<h3>I/O</h3>
<table id="ioTarTable">
	<tr class="header"><th class="test">tar</th> <th class="col">write requests</th> <th class="col">write kBs</th> <th class="col">read requests</th> <th class="col">read kBs</th> <th class="col"># multi-write sectors</th> <th class="col"># writes to multi-write sectors</th></tr>
</table>

<table id="ioRmTable">
	<tr class="header"><th class="test">rm</th> <th class="col">write requests</th> <th class="col">write kBs</th> <th class="col">read requests</th> <th class="col">read kBs</th> <th class="col"># multi-write sectors</th> <th class="col"># writes to multi-write sectors</th></tr>
</table>

<table id="ioPostmarkTable">
	<tr class="header"><th class="test">postmark</th> <th class="col">write requests</th> <th class="col">write kBs</th> <th class="col">read requests</th> <th class="col">read kBs</th> <th class="col"># multi-write sectors</th> <th class="col"># writes to multi-write sectors</th></tr>
</table>

<table id="ioAndrewTable">
	<tr class="header"><th class="test">andrew</th> <th class="col">write requests</th> <th class="col">write kBs</th> <th class="col">read requests</th> <th class="col">read kBs</th> <th class="col"># multi-write sectors</th> <th class="col"># writes to multi-write sectors</th></tr>
</table>


<hr>
<a name="history"></a>
<h2>Kudos History</h2>

<a name="time_history"></a>
<h3>Time</h3>
<p>
<img src="plots/time_tar.png" alt="time tar">
<img src="plots/time_rm.png" alt="time rm">
<img src="plots/time_postmark.png" alt="time postmark">
</p>

<a name="space_history"></a>
<h3>Space</h3>
<p>
<img src="plots/space_tar.png" alt="space tar">
<img src="plots/space_rm.png" alt="space rm">
<img src="plots/space_postmark.png" alt="space postmark">
</p>

<a name="io_history"></a>
<h3>I/O</h3>
<h4>All</h4>
<p>
<img src="plots/io_tar.png" alt="io tar">
<img src="plots/io_rm.png" alt="io rm">
<img src="plots/io_postmark.png" alt="io postmark">
</p>

<h4>Multi-writes</h4>
<p>
<img src="plots/io_multi_tar.png" alt="multi-io tar">
<img src="plots/io_multi_rm.png" alt="multi-io rm">
<img src="plots/io_multi_postmark.png" alt="multi-io postmark">
</p>


<hr>
<h2>Chdesc Overhead</h2>
Plot chdesc memory vs number of block writes?
(Is this a good way to give us an idea of how well optimizations work
among different tests?)

<hr>
<a name="su"></a>
<h2>Soft Update Correctness</h2>
TODO.

</body>
</html>
