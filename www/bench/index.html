<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
	"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>Kudos Test Metrics</title>

<style type="text/css">
table { border-collapse: collapse; border: 1px solid black; }
table caption { background-color: white; font-style: italic; margin: 1ex 0 0.25ex 0; }
table tr { background-color: rgb(255, 240, 230); border: 1px solid black; }
table tr:hover { background-color: white; }
table tr.header { border-bottom: 1px solid; }
table th { background-color: white; border: 1px solid black; }
table th#units { font-weight: normal; }
table th.row { font-weight: normal; text-align: left; }
table td { text-align: right; padding: 0.35ex 0.35em 0.35ex 0.35em; border: 1px solid black; }

hr { size: 1px; border: 0; color: #9e9e9e; background-color: #9e9e9e; height: 0.1ex; width: 100%; }
</style>

<script language="JavaScript"type="text/javascript" src="plots/time_tar.js"></script>
<script language="JavaScript"type="text/javascript" src="plots/time_rm.js"></script>
<script language="JavaScript"type="text/javascript" src="plots/time_postmark.js"></script>

<script language="JavaScript"type="text/javascript" src="plots/space_tar.js"></script>
<script language="JavaScript"type="text/javascript" src="plots/space_rm.js"></script>
<script language="JavaScript"type="text/javascript" src="plots/space_postmark.js"></script>

<script language="JavaScript"type="text/javascript" src="plots/io_tar.js"></script>
<script language="JavaScript"type="text/javascript" src="plots/io_rm.js"></script>
<script language="JavaScript"type="text/javascript" src="plots/io_postmark.js"></script>

<script language="JavaScript" type="text/javascript"> <!--
function sysName(testData)
{
	return testData[0] + ' ' + testData[1] + ' ' + testData[2];
}

function appendRowHeader(row, text)
{
	var node = document.createElement("th");
	node.className = "row";
	node.appendChild(document.createTextNode(text));
	row.appendChild(node);
}

function appendData(row, text)
{
	var node = document.createElement("td");
	node.appendChild(document.createTextNode(text));
	row.appendChild(node);
}

function addTimeTest(tblId, testData)
{
	var row = document.getElementById(tblId).insertRow(-1);
	appendRowHeader(row, sysName(testData));
	appendData(row, testData[3].toFixed(2));
	appendData(row, testData[6].toFixed(2));
	appendData(row, testData[12].toFixed(2));
	appendData(row, testData[9].toFixed(2));
}

function loadTimes()
{
	for (sys in time_tar_data)
		addTimeTest('timeTarTable', time_tar_data[sys]);
	for (sys in time_rm_data)
		addTimeTest('timeRmTable', time_rm_data[sys]);
	for (sys in time_postmark_data)
		addTimeTest('timePostmarkTable', time_postmark_data[sys]);
}

function addSpaceTest(tblId, testName, testData)
{
	var row = document.getElementById(tblId).insertRow(-1);
	var rollbackIndex = 30; // don't write #items for this index
	appendRowHeader(row, testName + ': ' + testData[2]);
	for (var i = 0; i <= rollbackIndex; i += 5)
	{
		var nitems = testData[i + 6];
		var sizeof = testData[i + 7];
		var size = (nitems * sizeof / 1024).toFixed(0);
		appendData(row, nitems);
		appendData(row, size);
		var str;
		if (i != rollbackIndex)
			str = nitems + ' (' + size + ' kB)';
		else
			str = size + ' kB';
		/*appendData(row, str);*/
	}
}

function loadSpace()
{
	for (sys in space_tar_data)
		addSpaceTest('spaceTable', 'tar', space_tar_data[sys]);
	for (sys in space_rm_data)
		addSpaceTest('spaceTable', 'rm', space_rm_data[sys]);
	for (sys in space_postmark_data)
		addSpaceTest('spaceTable', 'postmark', space_postmark_data[sys]);
}

function addIoTest(tblId, testData)
{
	var row = document.getElementById(tblId).insertRow(-1);
	appendRowHeader(row, sysName(testData));
	appendData(row, testData[3].toFixed(0));
	appendData(row, testData[6].toFixed(0));
	appendData(row, testData[15].toFixed(0));
	appendData(row, testData[18].toFixed(0));
	appendData(row, testData[9].toFixed(0));
	appendData(row, testData[12].toFixed(0));
}

function loadIo()
{
	for (sys in io_tar_data)
		addIoTest('ioTarTable', io_tar_data[sys]);
	for (sys in io_rm_data)
		addIoTest('ioRmTable', io_rm_data[sys]);
	for (sys in io_postmark_data)
		addIoTest('ioPostmarkTable', io_postmark_data[sys]);
}

function loadData()
{
	loadTimes();
	loadSpace();
	loadIo();
}
--> </script>
</head>
<body onLoad='loadData()'>

<img src="graph.png" align="right">
<h1>Kudos Test Metrics</h1>

Time (<a href="#time_pit">Current</a>, <a href="#time_history">History</a>),
Space (<a href="#space_pit">Current</a>, <a href="#space_history">History</a>),
I/O (<a href="#io_pit">Current</a>, <a href="#io_history">History</a>)

<hr>
<a name="current">
<h2>Current</h2>

<a name="time_pit">
<h3>Time</h3>
<table id="timeTarTable">
		<caption>tar</caption>
		<tr class="header"><th class="col"></th> <th class="col">real</th> <th class="col">sys</th> <th class="col">io</th> <th class="col">user</th></tr>
</table>

<table id="timeRmTable">
		<caption>rm</caption>
		<tr class="header"><th class="col"></th> <th class="col">real</th> <th class="col">sys</th> <th class="col">io</th> <th class="col">user</th></tr>
</table>

<table id="timePostmarkTable">
		<caption>postmark</caption>
		<tr class="header"><th class="col"></th> <th class="col">real</th> <th class="col">sys</th> <th class="col">io</th> <th class="col">user</th></tr>
</table>

<a name="space_pit">
<h3>Space</h3>
<table id="spaceTable">
		  <tr class="header"><th class="col"></th> <th class="col" colspan="2">bits</th> <th class="col" colspan="2">bytes</th> <th class="col" colspan="2">noops</th> <th class="col" colspan="2">all</th> <th class="col" colspan="2">deps</th> <th class="col" colspan="2">wrefs</th> <th class="col" colspan="2">rollback</th>
		  <tr class="header"><th class="units"></th> <th class="units">items</th> <th class="units">kB</th> <th class="units">items</th> <th class="units">kB</th> <th class="units">items</th> <th class="units">kB</th> <th class="units">items</th> <th class="units">kB</th> <th class="units">items</th> <th class="units">kB</th> <th class="units">items</th> <th class="units">kB</th> <th class="units">items</th> <th class="units">kB</th>
</table>

<a name="io_pit">
<h3>I/O</h3>
<table id="ioTarTable">
		<caption>tar</caption>
		<tr class="header"><th class="col"></th> <th class="col">write requests</th> <th class="col">write kBs</th> <th class="col">read requests</th> <th class="col">read kBs</th> <th class="col"># multi-write sectors</th> <th class="col"># writes to multi-write sectors</th></tr>
</table>

<table id="ioRmTable">
		<caption>rm</caption>
		<tr class="header"><th class="col"></th> <th class="col">write requests</th> <th class="col">write kBs</th> <th class="col">read requests</th> <th class="col">read kBs</th> <th class="col"># multi-write sectors</th> <th class="col"># writes to multi-write sectors</th></tr>
</table>

<table id="ioPostmarkTable">
		<caption>postmark</caption>
		<tr class="header"><th class="col"></th> <th class="col">write requests</th> <th class="col">write kBs</th> <th class="col">read requests</th> <th class="col">read kBs</th> <th class="col"># multi-write sectors</th> <th class="col"># writes to multi-write sectors</th></tr>
</table>


<hr>
<a name="history">
<h2>Kudos History</h2>

<a name="time_history">
<h3>Time</h3>
<p>
<img src="plots/time_tar.png">
<img src="plots/time_rm.png">
<img src="plots/time_postmark.png">
</p>

<a name="space_history">
<h3>Space</h3>
<p>
<img src="plots/space_tar.png">
<img src="plots/space_rm.png">
<img src="plots/space_postmark.png">
</p>

<a name="io_history">
<h3>I/O</h3>
<h4>All</h3>
<p>
<img src="plots/io_tar.png">
<img src="plots/io_rm.png">
<img src="plots/io_postmark.png">
</p>

<h4>Multi-writes</h3>
<p>
<img src="plots/io_multi_tar.png">
<img src="plots/io_multi_rm.png">
<img src="plots/io_multi_postmark.png">
</p>


<hr>
<h2>Chdesc Overhead</h2>
Plot chdesc memory vs number of block writes?
(Is this a good way to give us an idea of how well optimizations work
among different tests?)

<hr>
<a name="su">
<h2>Soft Update Correctness</h2>
TODO.

 </body>
</html>
