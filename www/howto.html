<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
	"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta http-equiv="Content-Language" content="en">

	<title>Featherstitch</title>

	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>

<div id="content">

	<h1>Downloading and using Featherstitch</h1>

	<h2>Getting the source</h2>

	<p>
	The Featherstitch sources are maintained in a source repository of
	some sort. (We haven't decided between svn and git just yet.)
	Anyway, you need to follow some instructions that we haven't posted
	yet to get them. Check back here later.
	</p>

	<p>
	For example, you might potentially be able to do this:
	</p>
	<div class="code">
	svn co http://featherstitch.cs.ucla.edu/svn/trunk/fstitch ~/fstitch
	</div>

	<h2>Configuring your kernel</h2>

	<p>
	Currently, Featherstitch is incompatible with a few Linux
	configuration options which are often enabled by default.
	Eventually we'd like to eliminate this problem, but for the time
	being, you will need to disable them in your kernel to compile and
	run Featherstitch. The list is:
	</p>
	<ul>
	<li><tt>CONFIG_SMP</tt></li>
	<li>On older 2.6 kernels: <tt>CONFIG_PREEMPT</tt></li>
	<li>On newer 2.6 kernels: all <tt>CONFIG_PREEMPT_*</tt> except <tt>CONFIG_PREEMPT_NONE</tt></li>
	<li><tt>CONFIG_LBD</tt></li>
	</ul>

	<p>
	We also recommend a few settings to make sure all of our scripts
	work well, and to enable additional debugging options:
	</p>
	<ul>
	<li><tt>CONFIG_PROC_FS</tt></li>
	<li><tt>CONFIG_IKCONFIG</tt></li>
	<li><tt>CONFIG_IKCONFIG_PROC</tt></li>
	<li><tt>CONFIG_SYSFS</tt></li>
	<li><tt>CONFIG_DEBUG_FS</tt></li>
	</ul>

	<p>
	The kernel .config files we use for Linux 2.6.20.1 are available:
	<a href="config-2.6.20.1-fstitch-debug">for debugging</a>,
	<a href="config-2.6.20.1-fstitch-prof">for profiling</a>, and
	<a href="config-2.6.20.1-fstitch-fast">for benchmarking</a>.

	<h2>Patching your kernel</h2>

	<p>
	Featherstitch will compile and run with an unmodified Linux kernel,
	but a few of its features will not work. In particular, patchgroups
	and FUA disk I/O will not work. There are some patches in the
	Featherstitch source that you can apply to the kernel to enable
	these features. The following commands assume Linux 2.6.20.1
	sources in <tt>~/linux-2.6.20.1</tt> and Featherstitch in
	<tt>~/fstitch</tt>.
	</p>

	<p>
	For patchgroups:
	</p>
	<div class="code">
	cd ~/linux-2.6.20.1<br>
	patch -p1 &lt; ~/fstitch/patches/fstitch-linux-2.6.20.1.patch
	</div>
	<p>
	You will also need to reconfigure your kernel to enable the new
	<tt>CONFIG_FSTITCH</tt> option (in the "File systems" section). The
	config files linked above have this option enabled already.
	</p>

	<p>
	For FUA disk I/O:
	</p>
	<div class="code">
	cd ~/linux-2.6.20.1<br>
	patch -p1 &lt; ~/fstitch/patches/bio-fua-2.6.20.1.patch
	</div>

	<h2>Configuring Featherstitch</h2>

	<p>
	Eventually, we'd like to have a configuration file that determines
	how Featherstitch starts up. For now, there is code in
	<tt>fscore/fstitchd_init.c</tt> that detects disks, partitions, and
	file systems, and instantiates Featherstitch modules to use them.
	Some of its behavior can be adjusted using <tt>insmod</tt>
	parameters, but you may need to edit this source file if your
	configuration is very different than ours.

	<h2>Compiling Featherstitch</h2>

	<p>
	You should be able to run <tt>make</tt> in the <tt>fstitch</tt>
	directory at this point, and Featherstitch should detect what kernel
	features are available and compile correctly. Please let us know if
	you encounter any compile errors!
	</p>

	<h2>Loading Featherstitch</h2>

	<p>
	The Featherstitch kernel module is created as
	<tt>fscore/kfstitchd.ko</tt>. It has several <tt>insmod</tt>
	options that affect the behavior of the code in
	<tt>fscore/fstitchd_init.c</tt> as described above. Here are a few
	of the more useful options:
	</p>
	<ul>
	<li><tt>device</tt>: The block device to scan for supported file systems</li>
	<li><tt>use_journal</tt>: Set to 1 (or 2) to use metadata (or full) journal_bd when .journal exists</li>
	<li><tt>use_unlink</tt>: Set to 1 to use the unlink device for asynchronous writes</li>
	<li><tt>use_crashsim</tt>: Set to 1 to use the crash simulator device</li>
	</ul>
	<p>
	The full list of supported options can be listed with this command:
	</p>
	<div class="code">
	modinfo fscore/kfstitchd.ko
	</div>

	<p>
	Once Featherstitch is loaded, the file system(s) it detects can be
	mounted using commands like:
	</p>
	<div class="code">
	mount -t fstitch fstitch:/ /mnt<br>
	mount -t fstitch fstitch:/dev /mnt/dev
	</div>

	<h2>Using patchgroups</h2>

	<p>
	Coming soon.
	</p>

	<h2>Debugging Featherstitch</h2>

	<p>
	Featherstitch includes a built-in patch debugger. To enable it, set
	<tt>FSTITCH_DEBUG</tt> to 1 in <tt>fscore/debug.h</tt> and
	recompile. When Featherstitch is loaded, it will create a file
	<tt>/proc/kfstitchd_debug</tt> which should be read and saved
	somewhere outside of the Featherstitch file system(s). This file
	will contain a (binary) trace of most patch-related changes inside
	of Featherstitch, and is very useful for debugging both correctness
	and performance problems. Using this option does, however, slow
	Featherstitch down somewhat.
	</p>

	<p>
	To analyze these debug traces, there is a utility called
	<tt>kdb</tt> which will be created as <tt>obj/util/kdb</tt> when
	Featherstitch is compiled.
	This section will soon describe how to use it.
	</p>

	<h2>Userspace Featherstitch</h2>

	<p>
	Featherstitch can also run as a FUSE file server process in
	userspace. In this mode, patchgroups are not available, and instead
	of the kernel block device layer, files in the normal Linux file
	system are used as block devices.
	This section will soon describe how to do this.
	</p>

	<h2>Questions? Comments?</h2>

	<p>
	Click below, subscribe to our mailing list, and send us your questions and comments:<br>
	<form action="/cgi-bin/mailman.cgi" method=POST>
	<input type=hidden name="list" value="featherstitch">
	<input type=image src="images/fstitch.png" alt="featherstitch list">
	</form>
	You can also try looking for us in #fstitch on irc.gimp.org.<br><br>
	</p>

</div>


<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-2452644-1";
urchinTracker();
</script>

</body>
</html>
