\section{\Modules}
\label{sec:modules}

\begin{comment}
This section describes several \Kudos\ \modules\ which contribute significantly
to the overall functionality of \Kudos, or which demonstrate unique or
important capabilities of \chdescs\ and the \module\ system. The journal
\module\ has already been described (in \S\ref{sec:using:journal}), while
others like the write-through cache, partitioner, and memory block device, have
functions which are fairly obvious from their names and need no further
description.
\end{comment}

\input{interfaces}

%% \input{uhfs}

\input{wbcache}

\subsection{Loopback Block Device}
\label{sec:modules:loop}

The loopback block device is a BD module which uses a file in an \LFS\ module as
its underlying data store. It is very similar to the device of the same name in
Linux, however it has one critical difference. The \Kudos\ loopback device is
aware of \chdescs, and therefore when a filesystem stored on a loopback device
sets up \chdesc\ dependencies, they will be correctly forwarded to and honored
by the rest of the system.

\begin{figure}[htb]
  \centering
  \includegraphics[height=3in]{fig/figures_1}
  \caption{A running \Kudos\ configuration. {\it/} is a soft updated
    file system on an IDE drive; {\it/loop} is an externally journaled
    file system on loop devices.}
  \label{fig:kfs-graph}
\end{figure}

Figure~\ref{fig:kfs-graph} shows an example configuration taking advantage of
this ability. A file system image is mounted with an external journal, both of
which are loopback block devices stored on the root file system, (which uses
soft updates). The journaled file system's ordering requirements are sent
through the loopback device as \chdescs, allowing dependency information to be
maintained across boundaries that might otherwise lose that information. In
contrast, without \chdescs\ and the ability to forward \chdescs\ through
loopback devices, BSD cannot express soft updates' consistency requirements
through loopback devices. The \modules\ in Figure~\ref{fig:kfs-graph} are a
complete and working \Kudos\ configuration, and although the use of a loopback
device is somewhat contrived in the example, they are increasingly being used in
conventional operating systems. For instance, Mac OS X uses them in order to
allow users to encrypt their home directories.

\begin{comment}
An example configuration taking advantage of this ability could be a file
system image mounted with an external journal, both of which are loopback block
devices stored on the root file system (which could use soft updates). The
journaled file system's ordering requirements are sent through the loopback
device as \chdescs, allowing dependency information to be maintained across
boundaries that might otherwise lose that information. In contrast, without
\chdescs\ and the ability to forward \chdescs\ through loopback devices, BSD
cannot express soft updates' consistency requirements through loopback devices.
Although the use of a loopback device is somewhat contrived in the example,
they are increasingly being used in conventional operating systems. For
instance, Mac OS X uses them in order to allow users to encrypt their home
directories.
\end{comment}

\input{ext2}
\input{ufs}

\begin{comment}
\subsection{Case Insensitivity}
\label{sec:modules:icase}

\Kudos\ provides a case insensitivity \module\ at the CFS layer. It allows file
systems such as UFS and ext2, which inherently handle filenames case
sensitively, to become case insensitive. If a user needs to run an application
that expects the underlying filenames to be case insensitive on top of a case
sensitive file system, they can simply add this \module\ to the \Kudos\
\module\ graph. By allowing a \module\ to intercept actions between the CFS and
\LFS\ layers, filename transformations can be made transparently for the user
regardless of the on-disk storage format of the actual filename.
\end{comment}
