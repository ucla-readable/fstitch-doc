\section{Design}
\label{sec:design}

We first describe the design of \Kudos's basic abstractions: \bdescs,
file system \modules, and \chdescs.

\subsection{\BDescs}

Disk blocks are represented by objects called \emph{\bdescs}. \Kudos\ maintains
a \bdesc\ object for each cached block, and tracks pointers to the \bdescs\
using reference counting. In addition to the ``retain'' and ``release''
operations which increment and decrement the reference counts, \Kudos\ also
provides an ``autorelease'' operation which decrements the usage count after the
calling system call completes. This is useful for simulating garbage collection.

\Kudos\ expects to be able to write blocks atomically. Thus, the modules that
interface with the disk return blocks that are 512 bytes long (the sector size).
However, a single \bdesc\ can correspond to a range of contiguous blocks. This
feature is used by the \Kudos\ block resizer module to ``join'' sector-sized
blocks into a more convenient size for the relevant file system, such as 2048 or
4096 bytes.

\input{interfaces}
